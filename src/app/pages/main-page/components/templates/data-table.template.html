<p-table #dt
         [columns]="selectedCols"
         [value]="dataItems"
         [lazy]="true"
         (onLazyLoad)="loadTableDataLazy($event)"
         [paginator]="true"
         [rows]="numberOfElements"
         [totalRecords]="totalElements"
         [loading]="loading"
         [responsive]="true"
         selectionMode="single"
         [(selection)]="selectedItem"
         (onRowSelect)="onRowSelect(dt)"
         [sortField]="sortField"
         [sortOrder]="sortOrder"
         [scrollable]="true"
         scrollHeight="400px">
  <ng-template pTemplate="caption"
               let-rowData>
    <div style="text-align:left"
         class="p-align-center">
      <p-multiSelect (onChange)="columnsChange()"
                     [options]="cols"
                     [(ngModel)]="selectedCols"
                     optionLabel="header"
                     selectedItemsLabel="{0} колонок выбрано"
                     [style]="{minWidth: '200px'}"
                     defaultLabel="Выбрать колонки">
      </p-multiSelect>

      <button (click)="onItemCreate(dt)"
              style="margin-left: 1em; top: -10px"
              type="button"
              class="ui-button-success"
              pButton
              icon="fa fa-plus"
              label="Добавить">
      </button>
      <button (click)="isFilterShown = !isFilterShown"
              style="margin-left: 1em; top: -10px"
              type="button"
              class="ui-button-success"
              pButton
              icon="fa fa-filter"
              label="{{isFilterShown ? 'Спрятать фильтр' : 'Показать фильтр'}}">
      </button>
      <button *ngIf="false"
              style="margin-left: 1em; top: -10px"
              type="button"
              class="ui-button-success"
              pButton
              icon="fa fa-trash"
              label="Очистить фильтры">
      </button>
    </div>

  </ng-template>
  <ng-template pTemplate="header"
               let-columns>
    <tr>
      <th *ngFor="let col of columns"
          [pSortableColumn]="col.field">
        {{col.header}}
        <p-sortIcon [field]="col.field"
                    ariaLabel="Activate to sort"
                    ariaLabelDesc="Activate to sort in descending order"
                    ariaLabelAsc="Activate to sort in ascending order">
        </p-sortIcon>
      </th>
    </tr>
    <tr [hidden]="!isFilterShown">
      <th *ngFor="let col of columns; let i = index">
        <div class="ui-inputgroup">
          <span *ngIf="['startDate', 'endDate'].includes(col.field)"
                class="ui-inputgroup-addon">
            <i class="pi pi-calendar calendar-filter-button"
               (click)="openCalendar(calendar)">
            </i>
            <p-calendar #calendar
                        [(ngModel)]="col.val"
                        (onSelect)="onDateSelect($event)"
                        [inputStyle]="{'width': '0','padding': '0','height': '0', 'border': '0'}"
                        [style]="{'position': 'fixed'}"
                        [locale]="calendarConf"
                        appendTo="body">
            </p-calendar>
          </span>
          <p-inputMask class="ui-inputgroup-addon"
                       *ngIf="['startDate', 'endDate'].includes(col.field)"
                       [style]="{'width':'100%'}"
                       [(ngModel)]="col.val"
                       mask="99/99/9999"
                       placeholder="dd/mm/yyyy"
                       slotChar="dd/mm/yyyy"
                       (onComplete)="dt.filter({id: -1, name: dateFormat(col.val)}, col.field, 'contains');">
          </p-inputMask>
          <span *ngIf="['startDate', 'endDate'].includes(col.field)"
                class="ui-inputgroup-addon">
            <i class="pi pi-times clean-filter-button"
               (click)="cleanFilter(dt, i, col.field, 'contains', col)">
            </i>
          </span>
          <p-autoComplete class="ui-inputgroup-addon table-filter"
                          *ngIf="!['startDate', 'endDate'].includes(col.field)"
                          [inputStyle]="{'width':'100%'}"
                          [suggestions]="searchItems"
                          field="name"
                          (onSelect)="dt.filter($event, col.field, 'contains')"
                          (keydown.enter)="dt.filter({id: -1, name: $event.target.value}, col.field, 'contains');searchItems = []"
                          (completeMethod)="filterSearch($event, col.field)"
                          appendTo="body">
          </p-autoComplete>
          <span *ngIf="!['startDate', 'endDate'].includes(col.field)"
                class="ui-inputgroup-addon">
            <i class="pi pi-times clean-filter-button"
               (click)="cleanFilter(dt, i, col.field, 'contains')">
            </i>
          </span>
        </div>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body"
               let-dataItem
               let-columns="columns"
               let-rowData>
    <tr [pSelectableRow]="rowData">
      <td *ngFor="let col of columns"
          style="text-align: center">
        <span
              [ngClass]="{'cell-active': col.field === 'active' && dataItem[col.field], 'cell-passive': col.field === 'active' && !dataItem[col.field]}">
          {{dataItem[col.field] | activeTags | nameTags | dateTimeTags  }}
        </span>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="summary"
               let-rowData>
    Всего {{dataItems?.length}} объектов
  </ng-template>
</p-table>
