<p-table #cdt
         [columns]="selectedCols"
         [value]="dataItems"
         [lazy]="true"
         (onLazyLoad)="loadCounterPartiesDataLazy($event)"
         [paginator]="true"
         [rows]="numberOfElements"
         [totalRecords]="totalElements"
         [loading]="loading"
         [responsive]="true"
         selectionMode="single"
         [(selection)]="selectedCounterparty"
         (onRowSelect)="onRowSelect($event)"
         [scrollable]="true"
         scrollHeight="400px">
  <ng-template pTemplate="caption"
               let-rowData>
    <div style="text-align:left"
         class="p-align-center">
      <p-multiSelect
        (onChange)="columnsChange()"
        [options]="cols"
        [(ngModel)]="selectedCols"
        optionLabel="header"
        selectedItemsLabel="{0} колонок выбрано"
        [style]="{minWidth: '200px'}"
        defaultLabel="Выбрать колонки">
      </p-multiSelect>

      <button (click)="onCounterpartyCreate()"
              style="margin-left: 1em; top: -10px"
              type="button"
              class="ui-button-success"
              pButton
              icon="fa fa-plus"
              label="Добавить">
      </button>
      <button (click)="isFilterShown = !isFilterShown"
              style="margin-left: 1em; top: -10px"
              type="button"
              class="ui-button-success"
              pButton
              icon="fa fa-filter"
              label="{{isFilterShown ? 'Спрятать фильтр' : 'Показать фильтр'}}">
      </button>
    </div>
  </ng-template>
  <ng-template pTemplate="header"
               let-columns>
    <tr>
      <th *ngFor="let col of columns"
          [pSortableColumn]="col.field === 'id' || col.field === 'name'? col.field : null">
        {{col.header}}
        <p-sortIcon *ngIf="col.field === 'id' || col.field === 'name'"
                    [field]="col.field"
                    ariaLabel="Activate to sort"
                    ariaLabelDesc="Activate to sort in descending order"
                    ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
      </th>
    <tr [hidden]="!isFilterShown">
      <th *ngFor="let col of columns" [ngSwitch]="col.field">
        <div *ngSwitchCase="'id'">
          <p-autoComplete [suggestions]="searchItems"
                          field="name"
                          (onSelect)="cdt.filter($event, col.field, 'contains')"
                          (keydown.enter)="cdt.filter($event.target.value, col.field, 'contains')"
                          (completeMethod)="filterSearch($event, col.field)"
                          appendTo="body"
                          #idFilter>
          </p-autoComplete>
          <button pButton
                  type="button"
                  icon="pi pi-times"
                  class="ui-button-secondary"
                  (click)="cleanFilter(cdt, idFilter, col.field, 'contains')">
          </button>
        </div>
        <div *ngSwitchCase="'name'">
          <p-autoComplete [suggestions]="searchItems"
                          field="name"
                          (onSelect)="cdt.filter($event, col.field, 'contains')"
                          (keydown.enter)="cdt.filter($event.target.value, col.field, 'contains')"
                          (completeMethod)="filterSearch($event, col.field)"
                          appendTo="body"
                          #nameFilter>
          </p-autoComplete>
          <button
            pButton
            type="button"
            icon="pi pi-times"
            class="ui-button-secondary"
            (click)="cleanFilter(cdt, nameFilter, col.field, 'contains')">
          </button>
        </div>

      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body"
               let-dataItem
               let-columns="columns"
               let-rowData>
    <tr [pSelectableRow]="rowData">
      <td *ngFor="let col of columns"
          style="text-align: center">
        <ng-container *ngIf="col.field !== 'active'">
          {{dataItem[col.field]}}
        </ng-container>
        <span *ngIf="col.field === 'active'"
              [ngClass]="dataItem[col.field] === true ? 'ekc-table-span-active': 'ekc-table-span-passive'">
          {{dataItem[col.field] | activeTags }}
        </span>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="summary" let-rowData>
    Всего {{dataItems?.length}} объектов
  </ng-template>
</p-table>

<app-counterparty-dialog
  [dadataConfig]="daDataConfig"
  (onNewCounterpartySaved)="onNewCounterpartySave($event)"
  (onEditedCounterpartySave)="onCounterpartyEditSave($event)"
  (onCloseDialog)="onCloseCounterpartyDialog($event)"
  [isNew]="isNewCounterparty"
  [counterparty]="counterparty"
  [display]="displayCounterpartyEditDialog">
</app-counterparty-dialog>



